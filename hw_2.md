```azure
1. открыть консоль и зайти по ssh на ВМ
2. открыть вторую консоль и также зайти по ssh на ту же ВМ (можно в докере 2 сеанса)
3. запустить везде psql из под пользователя postgres
4. сделать в первой сессии новую таблицу и наполнить ее данными
5. посмотреть текущий уровень изоляции:
6. начать новую транзакцию в обеих сессиях с дефолтным (не меняя) уровнем
   изоляции
7. в первой сессии добавить новую запись
8. сделать запрос на выбор всех записей во второй сессии
9. видите ли вы новую запись и если да то почему? После задания можете сверить
   правильный ответ с эталонным (будет доступен после 3 лекции)
10. завершить транзакцию в первом окне
11. сделать запрос на выбор всех записей второй сессии
12. видите ли вы новую запись и если да то почему?
13. завершите транзакцию во второй сессии
14. начать новые транзакции, но уже на уровне repeatable read в ОБЕИХ сессиях
15. в первой сессии добавить новую запись
16. сделать запрос на выбор всех записей во второй сессии
17. видите ли вы новую запись и если да то почему?
18. завершить транзакцию в первом окне
19. сделать запрос во выбор всех записей второй сессии
20. видите ли вы новую запись и если да то почему?
```

1. Создадим таблицу workers:
```azure
   CREATE TABLE Workers (
    worker_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    gender VARCHAR(50) CHECK (gender IN ('Мужской', 'Женский')) NOT NULL,
    birthdate DATE NOT NULL
);
```
2. Наполним таблицу workers:
```azure
INSERT INTO Workers (name, gender, birthdate) VALUES
('Иван Иванов', 'Мужской', '1985-05-12'),
('Анна Смирнова', 'Женский', '1990-07-23'),
('Сергей Петров', 'Мужской', '1978-03-09'),
('Ольга Кузнецова', 'Женский', '1982-12-15'),
('Дмитрий Соколов', 'Мужской', '1995-09-30'),
('Елена Федорова', 'Женский', '1992-11-05'),
('Алексей Попов', 'Мужской', '1980-02-20'),
('Мария Морозова', 'Женский', '1988-08-11'),
('Николай Павлов', 'Мужской', '1993-01-17'),
('Татьяна Орлова', 'Женский', '1987-06-25'),
('Вася Пупкин', 'Мужской', '2000-01-01');
INSERT 0 10
    
    worker_id |      name       | gender  | birthdate
-----------+-----------------+---------+------------
    1 | Иван Иванов     | Мужской | 1985-05-12
    2 | Анна Смирнова   | Женский | 1990-07-23
    3 | Сергей Петров   | Мужской | 1978-03-09
    4 | Ольга Кузнецова | Женский | 1982-12-15
    5 | Дмитрий Соколов | Мужской | 1995-09-30
    6 | Елена Федорова  | Женский | 1992-11-05
    7 | Алексей Попов   | Мужской | 1980-02-20
    8 | Мария Морозова  | Женский | 1988-08-11
    9 | Николай Павлов  | Мужской | 1993-01-17
    10 | Татьяна Орлова  | Женский | 1987-06-25
    (10 rows)
```

3. Структура созданной таблицы:
```azure
                                                                    Table "public.workers"
  Column   |          Type          | Collation | Nullable |                  Default                   | Storage  | Compression | Stats target | Description 
-----------+------------------------+-----------+----------+--------------------------------------------+----------+-------------+--------------+-------------
 worker_id | integer                |           | not null | nextval('workers_worker_id_seq'::regclass) | plain    |             |              | 
 name      | character varying(100) |           | not null |                                            | extended |             |              | 
 gender    | character varying(50)  |           | not null |                                            | extended |             |              | 
 birthdate | date                   |           | not null |                                            | plain    |             |              | 
Indexes:
    "workers_pkey" PRIMARY KEY, btree (worker_id)
Check constraints:
    "workers_gender_check" CHECK (gender::text = ANY (ARRAY['Мужской'::character varying::text, 'Женский'::character varying::text]))
Access method: heap
```

4. Узнаем уровень изоляции по умолчанию:
```azure
postgres=# SHOW default_transaction_isolation;
 default_transaction_isolation 
-------------------------------
 read committed
(1 row)
```

5.  Добавим новую запись в `workers`:
```azure
INSERT INTO workers (name, gender, birthdate) VALUES ('Вася Пупкин', 'Мужской', '1991-06-30');
```
6. В рамках текущей сессии мы увидим новую запись, но если сделаем выборку по таблице в другой сессии,
то мы не сможем увидеть новую запись, поскольку транзакция не была завершена
7. Проверим, появилась ли новая запись во второй сессии, после того, как мы завершили транзакцию:
```azure
postgres=# SELECT * FROM workers;
 worker_id |      name       | gender  | birthdate  
-----------+-----------------+---------+------------
         1 | Иван Иванов     | Мужской | 1985-05-12
         2 | Анна Смирнова   | Женский | 1990-07-23
         3 | Сергей Петров   | Мужской | 1978-03-09
         4 | Ольга Кузнецова | Женский | 1982-12-15
         5 | Дмитрий Соколов | Мужской | 1995-09-30
         6 | Елена Федорова  | Женский | 1992-11-05
         7 | Алексей Попов   | Мужской | 1980-02-20
         8 | Мария Морозова  | Женский | 1988-08-11
         9 | Николай Павлов  | Мужской | 1993-01-17
        10 | Татьяна Орлова  | Женский | 1987-06-25
        11 | Вася Пупкин     | Мужской | 1991-06-30
(11 rows)
```
Запись появилась, изменения доехали

8. Начнем новые транзации в ОБЕИХ сессиях с уровнем изоляции REPEATABLE_READ:
`BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;`
9. Добавим новую запись и выполним запрос на получение всех данных таблицы во второй сессии
Результат: мы не увидим добавленную запись, поскольку транзакция не завершена в первой сессии,
а описание документации для repeatable read гласит:
   `Все операторы текущей транзакции могут видеть только строки, зафиксированные до выполнения первого запроса или оператора модификации данных в этой транзакции.`
10. Завершим транзакцию в первой сессии и посмотрим что изменилось во второй сессии:
```azure
postgres=*# SELECT * FROM workers;
 worker_id |      name       | gender  | birthdate  
-----------+-----------------+---------+------------
        12 | Иван Иванов     | Мужской | 1985-05-12
        13 | Анна Смирнова   | Женский | 1990-07-23
        14 | Сергей Петров   | Мужской | 1978-03-09
        15 | Ольга Кузнецова | Женский | 1982-12-15
        16 | Дмитрий Соколов | Мужской | 1995-09-30
        17 | Елена Федорова  | Женский | 1992-11-05
        18 | Алексей Попов   | Мужской | 1980-02-20
        19 | Мария Морозова  | Женский | 1988-08-11
        20 | Николай Павлов  | Мужской | 1993-01-17
        21 | Татьяна Орлова  | Женский | 1987-06-25
        22 | Вася Пупкин     | Мужской | 2000-01-01
(11 rows)
```
Как видим, новая запись не появилась, поскольку мы запустили транзакцию 
с уровнем изоляции repeatable read в обоих сессиях, а управляя транзакцией такого типа
мы видимо только тот снимок данных, который был сделан до начала транзакции, поэтому таблица не обновится до завершения транзакции второй сессии.
